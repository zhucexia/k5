define("widget/detail/detail",["require","exports","module","components/jquery/jquery","components/template/template"],function(t,n,e){{var a=t("components/jquery/jquery"),o=t("components/template/template");e.exports=function(t){var n={init:function(){this.commentTemplate='<% for(var i = 0,len = data.data.length; i<len ;i++){%>\n<% var comment = data.data[i],path = data.contextpath ; %>\n<div class="comment cf comment_details" data-comment-id="<%=comment.id %>">\n    <div class="avatar left">\n        <a href="javascript:void(0)"><img alt="科技50用户<%=comment.author.nickname %>" src="<%=comment.author.image %>" raw_iden="<%=comment.id %>" class="before-fade-in"></a>\n    </div>\n    <div class="comment-wrapper">\n        <div class="postmeta"><a class="user_info_name" href="javascript:void(0)"><%=comment.author.nickname %></a>&nbsp;•&nbsp;\n            <abbr class="timeago" title="<%=comment.createDate %>"><%=comment.createDate %></abbr>\n        </div>\n        <div class="commemt-main">\n        	<p <% if(comment.state != \'c\') { %>class="pending"<% } %>>\n        	<%  if(comment.state == \'c\') { %>\n        	<span title="该评论正在审核中, 仅对本人可见" class="badge badge-warning">审核中</span>\n        	<% } \n        		if (comment.toAuthor) {\n        	%>\n        	<span class="replay-tips">回复<%=comment.toAuthor %>：</span>\n        	<% } %>\n            <%=comment.content %>\n            </p>\n        </div>\n        <div class="opts"></div>\n        <a class="pull-right" data-author="<%=comment.author.nickname%>" href="javascript:;"> 回复</a></div>\n</div>\n<%}%>   ',this.addEvent()},addEvent:function(){var n=this,e=0,i=setInterval(function(){e++,(loginInfo||e>100)&&(loginInfo&&loginInfo.isUserLogin?(a("#J_userInfo").show().find(".avatar").css("backgroundImage","url("+loginInfo.image+")"),a("#J_loginname").html(loginInfo.nickName),a(".require-login").show(),a(".J_requirelogin").hide()):(a(".require-login").hide(),a(".J_requirelogin").show()),n.getList(t.commentUrl,{author_id:loginInfo?loginInfo.id:0},"get",function(t){if(0==t.code&&t.data.length){a("#commentTotalCount,#commentFormCount").html(t.data.length);var e=o.parse(n.commentTemplate,{data:t});a("#J_comments").html(e)}}),clearInterval(i))},200);a("#J_comments").delegate(".pull-right","click",function(){var t=a(this).attr("data-author");a("#post").attr("data-author",t),a(".J_toAuthor").text(t),a(".reply_message").show()}),a("#J_userInfo .ladda-button").click(function(){var e=a("#post").val();e&&n.postComment(t.postUrl,{author_id:loginInfo.id,to_author:a("#post").attr("data-author"),content:e},function(t){if(0==t.code){a("#post").val(""),a(".J_delAuthor").click();var e=o.parse(n.commentTemplate,{data:t});a("#J_comments").prepend(e)}})}),a(".J_delAuthor").click(function(){a(".J_toAuthor").text(""),a(".reply_message").hide(),a("#post").attr("data-author","")})},getList:function(t,n,e,o){a.ajax({type:e,url:t,data:n,success:o}).complete(function(){})},postComment:function(t,n,e){a.ajax({type:"post",url:t,data:n,success:e}).complete(function(){})}};n.init()}}});