define("widget/detail/detail",["require","exports","module","components/jquery/jquery","components/template/template"],function(t,n,e){{var o=t("components/jquery/jquery"),a=t("components/template/template");e.exports=function(t){var n={init:function(){this.commentTemplate='<% for(var i = 0,len = data.data.length; i<len ;i++){%>\n<% var comment = data.data[i],path = data.contextpath ; %>\n<div class="comment cf comment_details" data-comment-id="<%=comment.id %>">\n    <div class="avatar left">\n        <a href="javascript:void(0)"><img alt="科技50用户<%=comment.author.nickname %>" src="<%=comment.author.image %>" raw_iden="<%=comment.id %>" class="before-fade-in"></a>\n    </div>\n    <div class="comment-wrapper">\n        <div class="postmeta"><a class="user_info_name" href="javascript:void(0)"><%=comment.author.nickname %></a>&nbsp;•&nbsp;\n            <abbr class="timeago" title="<%=comment.createDate %>"><%=comment.createDate %></abbr>\n        </div>\n        <div class="commemt-main">\n        	<p <% if(comment.state != \'c\') { %>class="pending"<% } %>>\n        	<%  if(comment.state == \'c\') { %>\n        	<span title="该评论正在审核中, 仅对本人可见" class="badge badge-warning">审核中</span>\n        	<% } \n        		if (comment.toAuthor) {\n        	%>\n        	<span class="replay-tips">回复<%=comment.toAuthor %>：</span>\n        	<% } %>\n            <%=comment.content %>\n            </p>\n        </div>\n        <div class="opts"></div>\n        <a class="pull-right" data-author="<%=comment.author.nickname%>" href="javascript:;"> 回复</a></div>\n</div>\n<%}%>   ',this.addEvent()},addEvent:function(){var n=this,e=0,i=setInterval(function(){e++,(loginInfo||e>100)&&(loginInfo&&console.log(loginInfo.isUserLogin),clearInterval(i),loginInfo&&loginInfo.isUserLogin?(console.log(loginInfo),o("#J_userInfo").show().find(".avatar").css("backgroundImage","url("+loginInfo.image+")"),o("#J_loginname").html(loginInfo.nickName),o(".require-login").show(),o(".J_requirelogin").hide()):(o(".require-login").hide(),o(".J_requirelogin").show()),n.getList(t.commentUrl,{author_id:loginInfo?loginInfo.id:0},"get",function(t){if(0==t.code&&t.data.length){o("#commentTotalCount,#commentFormCount").html(t.data.length);var e=a.parse(n.commentTemplate,{data:t});o("#J_comments").html(e)}}))},200);o("#J_comments").delegate(".pull-right","click",function(){var t=o(this).attr("data-author");o("#post").attr("data-author",t),o(".J_toAuthor").text(t),o(".reply_message").show()}),o("#J_userInfo .ladda-button").click(function(){var e=o("#post").val();e&&n.postComment(t.postUrl,{author_id:loginInfo.id,to_author:o("#post").attr("data-author"),content:e},function(t){if(0==t.code){o("#post").val(""),o(".J_delAuthor").click();var e=a.parse(n.commentTemplate,{data:t});o("#J_comments").prepend(e)}})}),o(".J_delAuthor").click(function(){o(".J_toAuthor").text(""),o(".reply_message").hide(),o("#post").attr("data-author","")})},getList:function(t,n,e,a){o.ajax({type:e,url:t,data:n,success:a}).complete(function(){console.log("success")})},postComment:function(t,n,e){o.ajax({type:"post",url:t,data:n,success:e}).complete(function(){console.log("success")})}};n.init()}}});